#!/bin/zsh

declare -A service_map

NS="${NS:=`kubens -c`}"

for svc in "$@"; do
	port=`kubectl -n $NS get svc $svc -o json | jq '.spec.ports[] | select(.name == "http" or .name == "mongodb" or .name == "redis") | .port'`
	service_map[$svc]=$port
done

(trap 'kill 0' SIGINT; for svc port in "${(@kv)service_map}"; do kubectl -n $NS port-forward services/$svc "$port:$port" &; done; wait)
