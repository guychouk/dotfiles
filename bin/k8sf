#!/bin/zsh

declare -A service_map

for svc in "$@"; do
	port=`kubectl get svc $svc -o json | jq '.spec.ports[] | select(.name == "http") | .port'`
	service_map[$svc]=$port
done

(trap 'kill 0' SIGINT; for key val in "${(@kv)service_map}"; do kubectl -n gval port-forward services/$key "$val:$val" &; done; wait)
