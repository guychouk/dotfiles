#!/bin/bash

# Show logs with colored status in a single line in the following format:
# [<level>] <messageData.message> (<messageData.parameters>)

stern --output raw "$@" | \
	jq --argjson levelmap '{ "info":"\u001b[32mINFO\u001b[0m", "debug":"\u001b[37mDEBUG\u001b[0m", "error":"\u001b[31mERROR\u001b[0m" }' \
	-Rr '. as $line | try (fromjson | "[\($levelmap[.level])] \u001b[0;44m\(.messageData.message)\u001b[0m (\(.messageData.parameters))") catch $line' | grep -v 'DEBUG'
